<link rel="import" href="components_full/bower_components/polymer/polymer.html">
<link rel="import" href="components_full/bower_components/core-ajax/core-ajax.html">

<link rel="import" href="components_full/bower_components/core-collapse/core-collapse.html">
<link rel="import" href="components_full/bower_components/paper-shadow/paper-shadow.html">
 
<polymer-element name="stop-card" attributes="stopID name">
  <template>
    <style>
      .stop_btn {
        position: relative;
        margin: 0;
        width: 100%;
        height: 100%;
        padding: 5% 0 3% 0;
        font-size: 1.75em;
        color: #00274c;
        border: 0;
        background: none;
        outline: 0;
      }

      .route-name {
        margin-top: 2%;
        font-family: sans-serif;
        font-weight: normal;
        font-size: 1.4em;
      }

      .route-name::before{
        content: url('icon_97/icon_97_small.png');
        margin-right: 4%;
      }


      .time-list {
        margin: -4% 0 7% 3%;
        font-size: 1.1em;
        font-family: sans-serif;
      }

      .card {
        background: white;
        width: 20%;
        min-width: 250px;
        height: auto;
        position: relative;
        margin: 20px auto;
        border-radius: 2px;
        padding: 0px 20px;
      }
    </style>

    <!--ajax calls here-->
    <core-ajax url="http://www.corsproxy.com/mbus.doublemap.com/map/v2/routes" auto handleAs="json" response="{{routes}}"></core-ajax>

    <core-ajax url="http://www.corsproxy.com/mbus.doublemap.com/map/v2/eta?stop={{stopID}}" auto handleAs="json" response="{{resp}}"></core-ajax>

    <div class="card">
      <paper-shadow z="1"></paper-shadow>
      <button class="stop_btn" on-click="{{toggle}}">{{name}}</button>
      <core-collapse opened="true" id="{{name}}">

        
      <template repeat="{{r in routes}}">
        <template repeat="{{s in r.stops}}">
          <template bind if="{{s == stopID}}">
            <h3 class="route-name">{{r.name}}</h3>
            <ul class="time-list" id="CS">
              <template repeat="{{route in resp.etas[stopID].etas}}">
                <template bind if="{{route.avg < 60 && route.route == r.id}}">
                  <li>{{route.avg}} minutes</li>
                </template>
              </template>
            </ul>
          </template>
        </template>
      </template>
    </div>


<!--
        
        <template repeat="{{r in routes}}">
          <template bind if="{{!stopID}}">
            <h3 class="route-name">{{r.name}}</h3>
            <ul class="time-list" id="CS">
              <template repeat="{{route in resp.etas[stopID].etas}}">
                <template bind if="{{route.avg < 60 && route.route == r.id}}">
                  <li>{{route.avg}} minutes</li>
                </template>
              </template>
            </ul>
          </template>
        </template>

        
        <h3 class="route-name">Commuter South</h3>
        <ul class="time-list" id="CS">
          <template repeat="{{route in resp.etas[stopID].etas}}">
            <template bind if="{{route.avg < 60}}">
              <li>{{route.avg}} minutes</li>
            </template>
          </template>
        </ul>


        
        <h3 class="route-name">Northwood</h3>
        <ul class="time-list" id="NW"></ul>
      </core-collapse>
    </div> 
--> 

  </template>


  <script>
    Polymer('stop-card', {
      stopID: "91",
      name: "Pierpont",
      toggle: function() {        
        console.log(this.name);
        this.$[this.name].toggle();
      }
    });

  </script>
</polymer-element>